@*@model IEnumerable<VideoRentalApplication.Model.Customer>
    @{
        ViewBag.Title = "Index";
    }*@

<h2>Customer List</h2>

@Html.ActionLink("New Customer", "CustomerForm", "", new { @class = "btn btn-success" })

<br />
<br />


<div>
    <table id="tblCustomer" class="table table-hover table-bordered table-striped">
        <thead>
            <tr>
                <th>Name</th>
                <th>Membershipt Type</th>
                <th>IsSubscribeToNewsLetter</th>
                <th>Delete</th>
            </tr>
        </thead>
        <tbody>
            @*@if (!Model.Any())
                {
                    <p>No records founf</p>
                }
                else
                {
                    foreach (var customer in Model)
                    {
                        using (Html.BeginForm("Delete", "Customer", new { Id = customer.Id }))
                        {
                            <tr>
                                <td>@Html.ActionLink(@customer.Name, "Edit", new { id = customer.Id })</td>
                                <td>@customer.MembershipType.Name</td>
                                <td><input type="submit" value="Delete" class="btn btn-link" onclick="return confirm('Are you sure, do you want to delete this record?')" /></td>
                            </tr>
                        }
                    }
                }*@


        </tbody>
    </table>
</div>

@section scripts{
    <script>
        //$(document).ready(function () {
        //    $('#tblCustomer').DataTable({
        //        "pageLength": 5,
        //        "lengthMenu": [[5, 10, 25, 50], [5, 10, 25, 50]], // Limits to 5, 10, 25, or 50 [2, 8]
        //        ajax: {
        //            url: '/api/CustomerAPI/AllCustomer',
        //            dataSrc: ""
        //        },
        //        columns: [
        //            {
        //                data: "Name"
        //            },
        //            {
        //                data: "MembershipType.Name"
        //            }
        //        ]

        //    });
        //})

        $(document).ready(function () {
            var table = $('#tblCustomer').DataTable({
                "pageLength": 5,
                "lengthMenu": [[5, 10, 25, 50], [5, 10, 25, 50]],
                ajax: {
                    url: '/api/CustomerAPI/AllCustomer',
                    dataSrc: ""
                },
                columns: [
                    {
                        data: "Name",
                        render: function (data, type, customer) {
                            return "<a href='/Customer/Edit/" + customer.id + "'>" + customer.name + "</a>";
                        }
                    },
                    {
                        data: "membershipType.name"
                    },
                    {
                        data: "isSubscribeToNewsLetter"
                    },
                    {
                        data: "id",
                        render: function (data) {
                            return "<button data-customer-id=" + data + " class='btn btn-link js-delete'>Delete</button>";
                        }
                    }
                ]
            });

            $('#tblCustomer').on("click", ".js-delete", function () {
                var button = $(this);
                //confirm("Are you sure, do you want to delete this record", function (result) {
                //    if (result) {
                //        debugger;
                //        $.ajax({
                //            url: '/api/CustomerAPI/' + button.attr('data-customer-id'),
                //            method: "DELETE",
                //            success: function () {
                //                alert('Record Successfully Deleted!');
                //            }
                //        })
                //    }
                //})
                if (confirm("Are you sure you want to delete this record?")) {
                    $.ajax({
                        url: '/api/CustomerAPI/DeleteCustomer?id= ' + button.attr('data-customer-id'),
                        method: "DELETE",
                        success: function () {
                            alert('Record Successfully Deleted!');
                            // with swal delete msg 
                            //Swal.fire({
                            //    title: 'Deleted!',
                            //    text: 'Record Successfully Deleted!',
                            //    icon: 'success',
                            //    confirmButtonText: 'OK'
                            //});
                            table.row(button.parents('tr')).remove().draw();

                            // alternate solution to refresh the dataTable after delete successfully.
                            //$("#tblCustomer").DataTable().ajax.reload();
                        },
                        error: function () {
                            alert("Error deleting record.")
                        }
                    })
                }
                else {
                    alert('Delete Cancelled');
                }
            })
        });

    </script>
}